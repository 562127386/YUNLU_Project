@*<link href="~/Content/css/framework-font.css" rel="stylesheet" />
    <link href="~/Content/css/framework-ui.css" rel="stylesheet" />
    <script src="~/Content/js/jquery/jquery-2.0.3.min.js"></script>
    <link href="~/Content/css/framework-theme.css" rel="stylesheet" />
    <link href="~/Content/js/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css/framework-theme.css" rel="stylesheet" />
    <script src="~/Content/js/charts/Chart.js"></script>*@
@*@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Index.cshtml";
}*@
<!DOCTYPE html>

<html>
<head>
    <title>@ViewBag.Title</title>
    <link href="~/Content/css/framework-font.css" rel="stylesheet" />
    <link href="~/Content/css/framework-index.css" rel="stylesheet" />
    <link href="~/Content/css/framework-theme.css" rel="stylesheet" />
    <script src="~/Content/js/jquery/jquery-2.0.3.min.js"></script>
    <script src="~/Content/js/bootstrap/bootstrap.min.js"></script>
    <link href="~/Content/js/bootstrap/bootstrap.min.css?v=1.0.3" rel="stylesheet" />
    <script src="~/Content/js/jqgrid/jqgrid.js?v=1.0.5"></script>
    <link href="~/Content/js/jqgrid/jqgrid2.css" rel="stylesheet" />
    <script src="~/Content/js/jqgrid/grid.locale-cn.js"></script>
    <link href="~/Content/js/select2/select2.min.css?v=1.0.1" rel="stylesheet" />
    <script src="~/Content/js/select2/select2.min.js"></script>

    <script src="~/Content/js/jsonsql/jsonsql.js"></script>
    <link href="~/Content/css/framework-ui.css" rel="stylesheet" />
    <script src="~/Content/js/common/framework-ui.js?v=1.0.3"></script>
    
</head>
<body>
</body>
</html>
<script>
    $(function () {
        gridList();
        //gridList_pxm();
        //gridList2();
        //document.getElementById("table").className = "table table-hover";

        //document.getElementById("table").setAttribute("class", "table table-hover");
        //$("#gridList").removeClass();
        //$("#gridList thead").removeClass();
        //$("#gridList tbody").removeClass();
        //$("#gridList th").removeClass(); gridList_CPpackage
        //$("#gridList tr").removeClass();
        //$("#gridList td").removeClass();
        //$("#gridList").addClass("table table-hover no-margins");
        //$("#gridList2").addClass("table table-hover no-margins");
        //$("#gridList td").addClass("label label-warning");
        //$("table").removeClass();
        //$(" thead").removeClass();
        //$(" tbody").removeClass();
        //$(" th").removeClass(); 
        //$(" tr").removeClass();
        //$(" td").removeClass();
        //$("table").addClass("table table-hover no-margins");
        //$("td").addClass("label label-warning");

    })
    function gridList() {
        $("#gridList").jqGrid(
            {
                height: 159,
                //width: $(window).width()*0.65,
                url: "/TN_XM/TN_HT_CG/GetGridJson",
                datatype: "json",
                colNames: ['主键', 'BindId', '采购组织', '合同编码', '设备包', '合同名称', '合同类型', '合同金额（元）', '支付方式', '已付金额（元）', '未付金额（元）', '支付比例', '资金来源', '计划终止日期', '供应商', '币种', '合同签订日期', '部门', '人员', '交货地点', '预付款（元）', '预付款限额', '合同状态', '创建时间', '创建人ID', '创建人姓名', '更新时间', '更新人ID', '更新人姓名'],
                colModel: [
                    { label: "Id", name: "Id", index: 'Id', width: 150, align: 'left', hidden: true },
                    { label: "BindId", name: "BindId", width: 150, align: 'left', hidden: true },
                    { label: "采购组织", name: "CGOrganization", width: 150, align: 'left', hidden: true },
                    { label: "合同编码", name: "Code", width: 150, align: 'left', hidden: true },
                    {
                        label: "设备包", name: "CPpackage", width: 90, align: 'left',
                        formatter: function (cellvalue, options, rowObject) {
                            return "<a  class='btn btn-info dropdown-text'  href='javascript:void(0)'  onclick=aclick('" + rowObject.Id + "')>" + rowObject.CPpackage + "</a>";
                        }
                    },
                    { label: "合同名称", name: "Name", width: 220, align: 'left' },
                    { label: "合同类型", name: "HTType", width: 150, align: 'left', hidden: true },
                    { label: "合同金额（元）", name: "Amount", width: 150, align: 'right' },
                    { label: "支付方式", name: "PayType", width: 150, align: 'left', hidden: true },
                    { label: "已付金额（元）", name: "paidAmount", width: 150, align: 'right' },
                    { label: "未付金额（元）", name: "unpaidAmount", width: 150, align: 'right' },
                    {
                        label: "支付比例", name: "PayProportion", width: 150, align: 'right',
                        formatter: function (cellvalue, options, rowObject) {
                            var paid = parseFloat(rowObject.paidAmount) / parseFloat(rowObject.Amount) * 100;
                            var per = paid.toFixed(2);
                            //return per + "%";
                            return '<div class="progress">'
                                + '<div class="progress-bar" role="progressbar" aria-valuenow="' + per + '"'
                                + ' aria-valuemin="0" aria-valuemax="100" style="width: ' + per + '%;">'
                                + ' <span style = "color: black">' + per + '% 完成</span>'
                                + '</div>'
                                + '</div>'
                        }
                    },
                    { label: "资金来源", name: "FundSource", width: 150, align: 'left', hidden: true },
                    { label: "计划终止日期", name: "EndTime", width: 150, align: 'left', hidden: true },
                    { label: "供应商", name: "Supplier", width: 150, align: 'left' },
                    { label: "币种", name: "currency", width: 150, align: 'left', hidden: true },
                    { label: "合同签订日期", name: "SigningDate", width: 150, align: 'left' },
                    { label: "部门", name: "Department", width: 150, align: 'left', hidden: true },
                    { label: "人员", name: "Personnel", width: 150, align: 'left', hidden: true },
                    { label: "交货地点", name: "Place", width: 150, align: 'left', hidden: true },
                    { label: "预付款（元）", name: "AdvancePayment", width: 150, align: 'left', hidden: true },
                    { label: "预付款限额 ", name: "Limit", width: 150, align: 'left', hidden: true },
                    { label: "合同状态", name: "HTState", width: 150, align: 'left' },
                    { label: "创建时间", name: "CreateDate", width: 150, align: 'left', hidden: true },
                    { label: "创建人ID", name: "CreateUserId", width: 150, align: 'left', hidden: true },
                    { label: "创建人姓名", name: "CreateUserName", width: 150, align: 'left', hidden: true },
                    { label: "更新时间", name: "UpdateDate", width: 150, align: 'left', hidden: true },
                    { label: "更新人ID", name: "UpdateUserId", width: 150, align: 'left', hidden: true },
                    { label: "更新人姓名", name: "UpdateUserName", width: 150, align: 'left', hidden: true },
                ],
                sortname: 'CreateDate',
                styleUI: 'Bootstrap',
                viewrecord: true,
                rowNum: 30,
                footerrow: true,
                rowList: [10, 20, 30],
                //pager: '#pager10',
                //viewrecords: true,
                sortorder: "asc",
                multiselect: false,
                //caption: "Invoice Header",
                onSelectRow: function (ids) {
                    var rowData = $("#gridList").getRowData(ids);
                    var queryJson = JSON.stringify({
                        Id: rowData.Id
                    });
                    if (ids == null) {
                        ids = 0;
                        if (jQuery("#gridList2").jqGrid('getGridParam',
                            'records') > 0) {
                            jQuery("#gridList2").jqGrid(
                                'setGridParam',
                                {
                                    url: "/TN_XM/TN_XM/GetGridJson3?queryJson="
                                        + queryJson,
                                    page: 1
                                });
                            jQuery("#gridList2").jqGrid('setCaption',
                                "亚行项目: " + ids).trigger(
                                    'reloadGrid');
                        }
                    } else {
                        jQuery("#gridList2").jqGrid('setGridParam', {
                            url: "/TN_XM/TN_XM/GetGridJson3?queryJson="
                                + queryJson,
                            page: 1
                        });
                        jQuery("#gridList2").jqGrid('setCaption',
                            "亚行项目: " + ids).trigger(
                                'reloadGrid');

                    }
                },
                ondblClickRow: function (ids) {
                    var rowData = $("#gridList").getRowData(ids);
                    var parentId = top.$.jfinetab.getCurrentTabId();
                    top.$.jfinetab.addTabContent("/TN_XM/TN_HT_CG/Details?keyValue=" + rowData.Id, "采购合同管理--查看", parentId + "_edit", parentId);
                },
                gridComplete: function () {
                    $(".ui-jqgrid-sdiv").show();
                    var Amount = $(this).getCol("Amount", false, "sum");
                    var paidAmount = $(this).getCol("paidAmount", false, "sum");
                    var unpaidAmount = $(this).getCol("unpaidAmount", false, "sum");
                    //合计
                    $(this).footerData("set", {
                        "Name": "合计：",
                        "Amount": Amount.toFixed(2),
                        "paidAmount": paidAmount.toFixed(2),
                        "unpaidAmount": unpaidAmount.toFixed(2)
                    });

                }

            });
        jQuery("#gridList").jqGrid('navGrid', '#gridPager', {
            add: false,
            edit: false,
            del: false
        });
        jQuery("#gridList2").jqGrid({
            height : 285,
            url: "/TN_XM/TN_XM/GetGridJson3",
            datatype : "json",
            colNames: ['主键', 'BindId', '主项目名称', '子项目名称', '项目编码', '编码前缀', '项目实施内容', '所属公司', '设备包', '亚行资金（元）', '配套资金（元）', '项目总投资（元）', '项目状态', '创建日期', '创建用户', '开始时间', '结束时间', '项目描述', '项目负责人', '项目负责人电话', '施工单位', '施工单位负责人', '施工单位负责人电话', '备注'],
                colModel: [

                        { label: "主键", name: "Id", width: 150, align: 'left', hidden: true },

                        { label: "BindId", name: "BindId", width: 150, align: 'left', hidden: true },

                        { label: "主项目名称", name: "BaseName", width: 150, align: 'left' },

                        { label: "子项目名称", name: "BaseSubName", width: 150, align: 'left' },

                        {
                            label: "项目编码", name: "Code", width: 200, align: 'left',
                            formatter: function (cellvalue, options, rowObject) {
                                var code = rowObject.RulesCode + "-" + rowObject.Code;
                                return code;
                            }, hidden: true
                        },

                        { label: "编码前缀", name: "RulesCode", width: 200, align: 'left', hidden: true },

                        { label: "项目实施内容", name: "Name", width: 300, align: 'left' },

                        { label: "所属公司", name: "CompanyName", width: 150, align: 'left' },

                        { label: "设备包", name: "CPpackage", width: 150, align: 'left', hidden: true },

                        { label: "亚行资金（元）", name: "TaxTotal", width: 150, align: 'right' },

                        { label: "配套资金（元）", name: "Amount", width: 150, align: 'right' },

                        {
                            label: "项目总投资（元）", name: "sumAmount", width: 150, align: 'right',
                            formatter: function (cellvalue, options, rowObject) {
                                var sum = parseFloat(rowObject.Amount) + parseFloat(rowObject.TaxTotal);
                                return sum.toFixed(2);
                                }
                        },

                         { label: "项目状态", name: "ProjectState", width: 150, align: 'left' },

                        { label: "创建日期", name: "CreateDate", width: 150, align: 'left', hidden: true },

                        { label: "创建用户", name: "CreateUserName", width: 150, align: 'left', hidden: true },

                        { label: "开始时间", name: "BeginDate", width: 150, align: 'left', hidden: true },

                        { label: "结束时间", name: "EndDate", width: 150, align: 'left', hidden: true },

                        { label: "项目描述", name: "DEC", width: 150, align: 'left', hidden: true },

                        { label: "项目负责人", name: "Principal", width: 150, align: 'left', hidden: true },

                        { label: "项目负责人电话", name: "Phone", width: 150, align: 'left', hidden: true },

                        { label: "施工单位", name: "ConstructionUnit", width: 150, align: 'left', hidden: true },

                        { label: "施工单位负责人", name: "CPrincipal", width: 150, align: 'left', hidden: true },

                        { label: "施工单位负责人电话", name: "CPhone", width: 150, align: 'left', hidden: true },

                        { label: "备注", name: "Remark", width: 150, align: 'left', hidden: true },

                ],
                rowNum: 200,
                rowList: [10, 20, 30],
                //pager: '#gridPager2',
                sortname: 'CreateDate',
                rownumbers: true ,
                viewrecords : true,
                sortorder : "asc",
                multiselect: false,
                caption: "亚行项目",
                onSelectRow: function (ids) {
                    var rowData = $("#gridList2").getRowData(ids);
                    var parentId = top.$.jfinetab.getCurrentTabId();
                    top.$.jfinetab.addTabContent("/TN_XM/TN_XM/Details2?keyValue=" + rowData.Id+"&Code="+rowData.Code, "项目信息", parentId + "_edit", parentId);
                },
                loadComplete: function () {
                    var rowIds = $('#gridList2').jqGrid('getDataIDs');
                    var sum = 0
                    for (var i = 0; i < rowIds.length; i++) {
                        var row = $('#gridList2').getRowData(rowIds[i]);
                        sum += parseFloat(row.TaxTotal);
                    }
                    var id = $('#gridList').jqGrid('getGridParam', 'selrow');
                    if (id != undefined && id != null && id != "") {
                         var ht = sum.toFixed(2);
                         jQuery("#gridList").setCell(id, 'Amount', ht);
                    }else{
                        return false;
                    }
                }

        })
        //jQuery("#ms1").click(function() {
        //    var s;
        //    s = jQuery("#list10_d").jqGrid('getGridParam', 'selarrrow');
        //    alert(s);
        //});
        $("#gridList").setGridWidth($(window).width() - 6);
        $("#gridList2").setGridWidth($(window).width() - 6);
    }


    function gridList_pxm() {
        var queryJson = {};
        queryJson.ParentName = "0";
        var $gridList = $("#gridList_pxm");
        $gridList.dataGrid({
            url: "/TN_XM/TN_XMBase/GetProjectGridJson",
            height: 196,
            postData: { queryJson: JSON.stringify(queryJson) },
            colModel: [

					{ label: "主键", name: "Id", width: 150, align: 'left', hidden: true },

					{ label: "BindId", name: "BindId", width: 150, align: 'left', hidden: true },
                    {
                        label: "主项目名称", name: "ParentName", width: 150, align: 'left', hidden: true, formatter: function (cellvalue, options, rowObject) {
                            if (cellvalue == "0") {
                                return "无"
                            } else {
                                return cellvalue;
                            }
                        }
                    },
					{ label: "编码", name: "Code", width: 100, align: 'left', hidden: true },

					{ label: "子项目名称", name: "Name", width: 300, align: 'left' },

					{ label: "项目描述", name: "DEC", width: 150, align: 'left', hidden: true },

					{ label: "备注", name: "Remark", width: 150, align: 'left', hidden: true },

					{ label: "创建日期", name: "CreateDate", width: 100, align: 'left', hidden: true },

					{ label: "创建用户", name: "CreateUserName", width: 100, align: 'left', hidden: true }

            ],
            pager: "#gridPager_pxm",
            sortname: 'CreateDate desc',
            rownumbers: true,
            rowNum: 200,
            rowList: [10, 20, 30],
            viewrecords: true,
            onSelectRow: function (ids) {
                var rowData = $("#gridList_pxm").getRowData(ids);
                var parentId = top.$.jfinetab.getCurrentTabId();
                top.$.jfinetab.addTabContent("/TN_XM/TN_XMBase/Details?keyValue=" + rowData.Id + "&Code=" + rowData.Code, "项目流程事记", parentId + "_edit", parentId);
            },
        });
        $gridList.setGridWidth($(window).width() - 36);
    }


    function aclick(keyValue) {
        var parentId = top.$.jfinetab.getCurrentTabId();
        top.$.jfinetab.addTabContent("/TN_XM/TN_HT_CG/Details?keyValue=" + keyValue, "采购合同管理--查看", parentId + "_edit", parentId);
    }
      
</script>
<body>
    <div id="areascontent">
        <div class="rows" style="overflow: hidden;">
            <div style="float: left; width:100%; margin-right: 1%;">
                <div style="height: 265px; border: 1px solid #e6e6e6; background-color: #fff;">
                    <div class="panel panel-default">
                        <div class="panel-heading"><i class="fa fa-thumbs-o-up fa-lg" style="padding-right: 5px;"></i>采购合同</div>
                        <div class="gridPanel">
                                <table id="gridList"></table>
                                <div id="gridPager"></div>
                        </div>
                    </div>
                </div>
            </div>
            @*<div style="float: right; width: 34%;">
                <div style="height: 265px; border: 1px solid #e6e6e6; background-color: #fff;">
                <div class="panel panel-default">
                    <div class="panel-heading"><i class="fa fa-send fa-lg" style="padding-right: 5px;"></i>项目流程事记</div>
                    <div class="gridPanel">
                        <table id="gridList_pxm"></table>
                        <div id="gridPager_pxm"></div>
                    </div>
                    </div>
                </div>
            </div>*@
        </div>
        @*<div class="rows" style="margin-bottom: 1%; border: 1px solid #e6e6e6; overflow: hidden; padding-left: 1px;">
                <div class="panel panel-default">
                    <div class="panel-heading">
                    </div>
                    <div class="panel-body">
                    </div>
                </div>
            </div>*@
        <div class="rows" style="margin-bottom: 1%; overflow: hidden;">
        </div>
        <div class="rows" style="margin-bottom: 1%; border: 1px solid #e6e6e6; overflow: hidden; padding-left: 1px;">
            <div class="panel panel-default">
                <div class="gridPanel">
                    <table id="gridList2"></table>
                    <div id="gridPager2"></div>
                </div>
            </div>
        </div>
    </div>
    <style>
        #copyrightcontent {
            height: 30px;
            line-height: 29px;
            overflow: hidden;
            position: absolute;
            top: 100%;
            margin-top: -30px;
            width: 100%;
            background-color: #fff;
            border: 1px solid #e6e6e6;
            padding-left: 10px;
            padding-right: 10px;
        }

        .dashboard-stats {
            float: left;
            width: 20%;
        }

        .dashboard-stats-item {
            position: relative;
            overflow: hidden;
            color: #fff;
            cursor: pointer;
            height: 105px;
            margin-right: 25px;
            margin-bottom: 10px;
            padding: 20px 20px;
        }

            .dashboard-stats-item .m-top-none {
                margin-top: 2px;
            }

            .dashboard-stats-item h2 {
                font-size: 35px;
                font-family: inherit;
                line-height: 1.1;
                font-weight: 500;
            }

            .dashboard-stats-item h5 {
                font-size: 14px;
                font-family: inherit;
                margin-top: 3px;
                line-height: 1.1;
            }


            .dashboard-stats-item .stat-icon {
                position: absolute;
                top: 10px;
                right: 10px;
                font-size: 30px;
                opacity: .3;
            } 

        .dashboard-stats i.fa.stats-icon {
            width: 50px;
            padding: 20px;
            font-size: 50px;
            text-align: center;
            color: #fff;
            height: 50px;
            border-radius: 10px;
        }

        .panel-default {
            border: none;
            border-radius: 0px;
            margin-bottom: 0px;
            box-shadow: none;
            -webkit-box-shadow: none;
        }

            .panel-default > .panel-heading {
                color: #777;
                background-color: #fff;
                border-color: #e6e6e6;
                padding: 10px 10px;
            }

            .panel-default > .panel-body {
                padding: 10px;
                padding-bottom: 0px;
            }

                .panel-default > .panel-body ul {
                    overflow: hidden;
                    padding: 0;
                    margin: 0px;
                    margin-top: -5px;
                }

                    .panel-default > .panel-body ul li {
                        line-height: 27px;
                        list-style-type: none;
                        /*white-space: nowrap;*/
                        text-overflow: ellipsis;
                    }

                        .panel-default > .panel-body ul li .time {
                            color: #a1a1a1;
                            float: right;
                            padding-right: 5px;
                        }
        #gridList {
            background-color: white;
        }
        .ui-jqgrid .table-bordered th {
            background-color: white;
        }
        .ui-jqgrid .ui-jqgrid-bdiv {
            overflow-x: hidden;
        }

        /*.ui-jqgrid .table-bordered td {
            border: 1px solid #d7d7d7;
            border-left: 0px dashed #ddd !important;
        }
        .ui-jqgrid .table-bordered th {
            border-left: 0px dashed #ddd;
        }
        .table-bordered > thead > tr > th {
            border: 0px solid #ddd;
        }*/

        .btn {
            padding: 3px 6px;
        }
    </style>
</body>

