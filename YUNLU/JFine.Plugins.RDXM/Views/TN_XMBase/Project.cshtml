@*------------------------------------------------------------------------------
    *     此代码由T4模板自动生成
    *	   生成时间 2018-08-23 10:07:15
    *     ©为之团队
    *------------------------------------------------------------------------------*@

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
}
<script>
    $(function () {
        $('#layout').layout();
        treeView();
        gridList();
    });
    function treeView() {
        $("#itemTree").treeview({
            url: "/TN_XM/TN_XMBase/GetTreeJson2",
            onnodeclick: function (item) {
                $("#txt_keyword").val('');
                $('#btn_search').trigger("click");
            }
        });
        $("#itemTree").css({ "overflow": "hidden" });
    }
   /* function gridList() {
        var $gridList = $("#gridList");
        $gridList.dataGrid({

            url: "/TN_XM/TN_XMBase/GetProjectGridJsonXM",
            height: $(window).height() - 138,
            colModel: [

					{ label: "主键", name: "Id", width: 150, align: 'left', hidden: true },

					{ label: "BindId", name: "BindId", width: 150, align: 'left', hidden: true },
                    {
                        label: "上级项目", name: "ParentName", width: 150, align: 'left', formatter: function (cellvalue, options, rowObject) {
                            if (cellvalue == "0") {
                                return "无"
                            } else {
                                return cellvalue;
                            }
                        }
                    },
					{ label: "编码", name: "Code", width: 150, align: 'left' },

					{ label: "名称", name: "Name", width: 150, align: 'left' },

					{ label: "开始时间", name: "BeginDate", width: 150, align: 'left' },

					{ label: "结束时间", name: "EndDate", width: 150, align: 'left' },

					{ label: "项目描述", name: "DEC", width: 150, align: 'left' },

					{ label: "项目负责人", name: "Principal", width: 150, align: 'left' },

					{ label: "负责人电话", name: "Phone", width: 150, align: 'left' },

					{ label: "施工单位", name: "ConstructionUnit", width: 150, align: 'left' },

					{ label: "施工单位负责人", name: "CPrincipal", width: 150, align: 'left' },

					{ label: "施工单位负责人电话", name: "CPhone", width: 150, align: 'left' },

					{ label: "备注", name: "Remark", width: 150, align: 'left' },

					{ label: "创建日期", name: "CreateDate", width: 150, align: 'left' },

					{ label: "创建用户", name: "CreateUserName", width: 150, align: 'left' }

            ],
            pager: "#gridPager",
            sortname: 'CreateDate desc',
            viewrecords: true
        });
        $("#btn_search").click(function () {
            var queryJson = {
                itemId: $("#itemTree").getCurrentNode().id,
                Name: $("#txt_keyword").val()
            }
            $gridList.jqGrid('setGridParam', {
                postData: { queryJson: JSON.stringify(queryJson) }, page: 1
            }).trigger('reloadGrid');
        });
    }*/
    function gridList() {
        var $gridList = $("#gridList");
        $gridList.dataGrid({
            // url: "/TN_XM/TN_XMBase/GetProjectGridJson",GetTreeGridJson            
            url: "/TN_XM/TN_XMBase/GetProjectGridJson2",
            height: $(window).height() - 138,
            colModel: [


					{
					    label: "主项目编码", name: "Code1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'Code1' + rowId + "\'";
					    }
					},

					{
					    label: "主项目名称", name: "Name1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'Name1' + rowId + "\'";
					    }
					},

					{
					    label: "开始时间", name: "BeginDate1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'BeginDate1' + rowId + "\'";
					    }
					},

					{
					    label: "结束时间", name: "EndDate1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'EndDate1' + rowId + "\'";
					    }
					},

					{
					    label: "项目描述", name: "DEC1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'DEC1' + rowId + "\'";
					    }
					},

					{
					    label: "项目负责人", name: "Principal1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'Principal1' + rowId + "\'";
					    }
					},

					{
					    label: "负责人电话", name: "Phone1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'Phone1' + rowId + "\'";
					    }
					},

					{
					    label: "施工单位", name: "ConstructionUnit1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'ConstructionUnit1' + rowId + "\'";
					    }
					},

					{
					    label: "施工单位负责人", name: "CPrincipal1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'CPrincipal1' + rowId + "\'";
					    }
					},

					{
					    label: "施工单位负责人电话", name: "CPhone1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'CPhone1' + rowId + "\'";
					    }
					},

					{
					    label: "备注", name: "Remark", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'Remark' + rowId + "\'";
					    }
					},

					{
					    label: "项目创建人", name: "CreateUserName1", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
					        //合并单元格
					        //return 'id=\'CreateUserName1' + rowId + "\'";
					    }
					},


                    {
                        label: "一级项目编码", name: "Code2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Code2' + rowId + "\'";
                        }
                    },

                    {
                        label: "一级项目名称", name: "Name2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Name2' + rowId + "\'";
                        }
                    },

                    {
                        label: "开始时间", name: "BeginDate2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'BeginDate2' + rowId + "\'";
                        }
                    },

                    {
                        label: "结束时间", name: "EndDate2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'EndDate2' + rowId + "\'";
                        }
                    },

                    {
                        label: "项目描述", name: "DEC2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'DEC2' + rowId + "\'";
                        }
                    },

                    {
                        label: "项目负责人", name: "Principal2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Principal2' + rowId + "\'";
                        }
                    },

                    {
                        label: "负责人电话", name: "Phone2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Phone2' + rowId + "\'";
                        }
                    },

                    {
                        label: "施工单位", name: "ConstructionUnit2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'ConstructionUnit2' + rowId + "\'";
                        }
                    },

                    {
                        label: "施工单位负责人", name: "CPrincipal2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'CPrincipal2' + rowId + "\'";
                        }
                    },

                    {
                        label: "施工单位负责人电话", name: "CPhone2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'CPhone2' + rowId + "\'";
                        }
                    },

                    {
                        label: "备注", name: "Remark2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Remark2' + rowId + "\'";
                        }
                    },

                    {
                        label: "项目创建人", name: "CreateUserName2", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'CreateUserName2' + rowId + "\'";
                        }
                    },


                    {
                        label: "项目事项编码", name: "Code3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Code3' + rowId + "\'";
                        }
                    },

                    {
                        label: "项目事项名称", name: "Name3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Name3' + rowId + "\'";
                        }
                    },

                    {
                        label: "开始时间", name: "BeginDate3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'BeginDate3' + rowId + "\'";
                        }
                    },

                    {
                        label: "结束时间", name: "EndDate3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'EndDate3' + rowId + "\'";
                        }
                    },

                    {
                        label: "项目描述", name: "DEC3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'DEC3' + rowId + "\'";
                        }
                    },

                    {
                        label: "项目负责人", name: "Principal3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Principal3' + rowId + "\'";
                        }
                    },

                    {
                        label: "负责人电话", name: "Phone3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Phone3' + rowId + "\'";
                        }
                    },

                    {
                        label: "施工单位", name: "ConstructionUnit3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'ConstructionUnit3' + rowId + "\'";
                        }
                    },

                    {
                        label: "施工单位负责人", name: "CPrincipal3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'CPrincipal3' + rowId + "\'";
                        }
                    },

                    {
                        label: "施工单位负责人电话", name: "CPhone3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'CPhone3' + rowId + "\'";
                        }
                    },

                    {
                        label: "备注", name: "Remark3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Remark3' + rowId + "\'";
                        }
                    },

                    {
                        label: "项目创建人", name: "CreateUserName3", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'CreateUserName3' + rowId + "\'";
                        }
                    },


                    {
                        label: "合同编码", name: "Code", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Code' + rowId + "\'";
                        }
                    },

                    {
                        label: "合同名称", name: "Name4", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Name4' + rowId + "\'";
                        }
                    },

                    {
                        label: "甲方", name: "AName", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'AName' + rowId + "\'";
                        }
                    },

                    {
                        label: "乙方", name: "BName", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'BName' + rowId + "\'";
                        }
                    },

                    {
                        label: "签订日期", name: "SignDate", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'SignDate' + rowId + "\'";
                        }
                    },

                    {
                        label: "签订地点", name: "SignPlace", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'SignPlace' + rowId + "\'";
                        }
                    },

                    {
                        label: "合同金额", name: "Amount", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'Amount' + rowId + "\'";
                        }
                    },

                    {
                        label: "支付方式", name: "PayType", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'PayType' + rowId + "\'";
                        }
                    },

                    {
                        label: "资金来源", name: "FundSource", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'FundSource' + rowId + "\'";
                        }
                    },

                    {
                        label: "合同文本", name: "DEC4", width: 150, align: 'left', cellattr: function (rowId, tv, rawObject, cm, rdata) {
                            //合并单元格
                            //return 'id=\'DEC4' + rowId + "\'";
                        }
                    },

                    { label: "备注", name: "Remark4", width: 150, align: 'left' },


                    { label: "设备分类", name: "Classify", width: 90, align: 'left' },

					{ label: "设备名称", name: "Name", width: 100, align: 'left' },

					{ label: "数量", name: "Quantity", width: 90, align: 'left' },

					{ label: "单位", name: "Unit", width: 60, align: 'left' },

					{ label: "产品规格及型号", name: "Type", width: 150, align: 'left' },

					{ label: "制造厂家名称", name: "MakeName", width: 150, align: 'left' },

					{ label: "出厂单价", name: "Price", width: 100, align: 'left' },

					{ label: "每一品目出厂价", name: "ItemPrice", width: 100, align: 'left' },

					{ label: "每一品目应缴税费", name: "ItemTax", width: 100, align: 'left' },

					{ label: "每一品目含税价格", name: "IncludTax", width: 100, align: 'left' },
                    { label: "项目现场", name: "Scene", width: 150, align: 'left' },
                    { label: "交货时间", name: "DeliveryTime", width: 150, align: 'left' }

            ],
            pager: "#gridPager",
            sortname: 'CreateDate desc',
            viewrecords: true,
            gridComplete: function () {
                //②在gridComplete调用合并方法
                var gridName = "gridList";
                Merger(gridName, 'Code1');
                Merger(gridName, 'Name1');
                Merger(gridName, 'BeginDate1');
                Merger(gridName, 'EndDate1');
                Merger(gridName, 'DEC1');
                Merger(gridName, 'Principal1');
                Merger(gridName, 'Phone1');
                Merger(gridName, 'ConstructionUnit1');
                Merger(gridName, 'CPrincipal1');
                Merger(gridName, 'CPhone1');
                Merger(gridName, 'Remark');
                Merger(gridName, 'CreateUserName1');


                Merger(gridName, 'Code2');
                Merger(gridName, 'Name2');
                Merger(gridName, 'BeginDate2');
                Merger(gridName, 'EndDate2');
                Merger(gridName, 'DEC2');
                Merger(gridName, 'Principal2');
                Merger(gridName, 'Phone2');
                Merger(gridName, 'ConstructionUnit2');
                Merger(gridName, 'CPrincipal2');
                Merger(gridName, 'CPhone2');
                Merger(gridName, 'Remark2');
                Merger(gridName, 'CreateUserName2');


                Merger(gridName, 'Code3');
                Merger(gridName, 'Name3');
                Merger(gridName, 'BeginDate3');
                Merger(gridName, 'EndDate3');
                Merger(gridName, 'DEC3');
                Merger(gridName, 'Principal3');
                Merger(gridName, 'Phone3');
                Merger(gridName, 'ConstructionUnit3');
                Merger(gridName, 'CPrincipal3');
                Merger(gridName, 'CPhone3');
                Merger(gridName, 'Remark3');
                Merger(gridName, 'CreateUserName3');

                Merger(gridName, 'Code');
                Merger(gridName, 'Name4');
                Merger(gridName, 'AName');
                Merger(gridName, 'BName');
                Merger(gridName, 'SignDate');
                Merger(gridName, 'SignPlace');
                Merger(gridName, 'Amount');
                Merger(gridName, 'PayType');
                Merger(gridName, 'FundSource');
                Merger(gridName, 'DEC4');
                Merger(gridName, 'Remark4');


            }


        });

        //公共调用方法
        function Merger(gridName, CellName) {
            //得到显示到界面的id集合
            var mya = $("#" + gridName + "").getDataIDs();
            //当前显示多少条
            var length = mya.length;
            for (var i = 0; i < length; i++) {
                //从上到下获取一条信息
                var before = $("#" + gridName + "").jqGrid('getRowData', mya[i]);
                //定义合并行数
                var rowSpanTaxCount = 1;
                for (j = i + 1; j <= length; j++) {
                    //和上边的信息对比 如果值一样就合并行数+1 然后设置rowspan 让当前单元格隐藏
                    var end = $("#" + gridName + "").jqGrid('getRowData', mya[j]);
                    if (before[CellName] == end[CellName]) {
                        rowSpanTaxCount++;
                        $("#" + gridName + "").setCell(mya[j], CellName, '', { display: 'none' });
                    } else {
                        rowSpanTaxCount = 1;
                        break;
                    }
                    $("#" + CellName + "" + mya[i] + "").attr("rowspan", rowSpanTaxCount);
                }
            }
        }

        $("#btn_search").click(function () {
            var queryJson = {
                itemId: $("#itemTree").getCurrentNode().id,
                Name1: $("#Name1").val(),
                Name2: $("#Name2").val(),
                Name3: $("#Name3").val(),
                Name4: $("#Name4").val(),
            }
            $gridList.jqGrid('setGridParam', {
                postData: { queryJson: JSON.stringify(queryJson) }, page: 1
            }).trigger('reloadGrid');
        });
    }
    function btn_add() {
        var parentId = top.$.jfinetab.getCurrentTabId();
        top.$.jfinetab.addTabContent("/TN_XM/TN_XMBase/Form?operation=add", "基本项目--新增", parentId + "_add", parentId);
    }
    function btn_edit() {
        var keyValue = $("#gridList").jqGridRowValue().Id;
        if ($.checkedArray(keyValue)) {

            var parentId = top.$.jfinetab.getCurrentTabId();
            top.$.jfinetab.addTabContent("/TN_XM/TN_XMBase/Form?keyValue=" + keyValue, "基本项目--修改", parentId + "_edit", parentId);
        }

    }
    function btn_delete() {
        var keyValue = $("#gridList").jqGridRowValue().Id;
        if ($.checkedArray(keyValue)) {
            $.deleteForm({
                url: "/TN_XM/TN_XMBase/DeleteForm",
                param: { keyValue: keyValue },
                success: function () {
                    $.currentWindow().$("#gridList").trigger("reloadGrid");
                }
            });
        }

    }
    function btn_details() {
        var keyValue = $("#gridList").jqGridRowValue().Id;
        if ($.checkedArray(keyValue)) {
            var parentId = top.$.jfinetab.getCurrentTabId();
            top.$.jfinetab.addTabContent("/TN_XM/TN_XMBase/Details?keyValue=" + keyValue, "基本项目--查看", parentId + "_details", parentId);
        }
    }
</script>


<div class="ui-layout" id="layout" style="height: 100%; width: 100%;">
    <div class="ui-layout-west">
        <div id="itemTree"></div>
    </div>
    <div class="ui-layout-center">
        <div class="topPanel">
            <div class="toolbar">
                <div class="btn-group">
                    <a class="btn btn-primary" onclick="$.reload()"><span class="glyphicon glyphicon-refresh"></span></a>
                </div>
               
                <div id="toolbar" class="btn-group">
                </div>
                <script>$('#toolbar').authorizeButton()</script>
            </div>
            <div class="search">
                <table>
                    <tr>
                        <td>
                            <div class="input-group">
                                <input id="Name1" type="text" class="form-control" placeholder="主项目" style="width: 200px;">
                                <span class="input-group-btn">
                                    <button id="btn_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                                </span>
                                @*<input id="Name2" type="text" class="form-control" placeholder="一级项目名称" style="width: 200px;">
                                <span class="input-group-btn">
                                    <button id="btn_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                                </span>
                                <input id="Name3" type="text" class="form-control" placeholder="项目事项名称" style="width: 200px;">
                                <span class="input-group-btn">
                                    <button id="btn_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                                </span>
                                <input id="Name4" type="text" class="form-control" placeholder="合同名称" style="width: 200px;">
                                <span class="input-group-btn">
                                    <button id="btn_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                                </span>*@
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="gridPanel">
            <table id="gridList"></table>
        </div>
    </div>
</div>